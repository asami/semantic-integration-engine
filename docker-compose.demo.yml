version: "3.9"

services:

  #######################################################################
  # FUSEKI — RDF / SPARQL server
  #######################################################################
  fuseki:
    image: ghcr.io/asami/preload-fuseki:latest
    container_name: sie-fuseki
    platform: linux/amd64
    ports:
      - "9030:3030"
    restart: unless-stopped
    networks:
      - sie-net


  #######################################################################
  # SIE-EMBEDDING — Lightweight embedding service
  #######################################################################
  sie-embedding:
    image: ghcr.io/asami/sie-embedding:latest
    container_name: sie-embedding
    ports:
      - "8081:8081"
    restart: unless-stopped
    networks:
      - sie-net


  #######################################################################
  # SIE — Semantic Integration Engine (HTTP + MCP WebSocket)
  #######################################################################
  sie:
    image: ghcr.io/asami/sie:0.0.3.8
    command:
      - "java"
      - "-Dconfig.resource=application.demo.conf"
      - "-jar"
      - "/app/semantic-integration-engine.jar"
    container_name: sie
    depends_on:
      fuseki:
        condition: service_started
      sie-embedding:
        condition: service_started

    ports:
      - "9050:9050"   # HTTP RAG API
      - "9051:9051"   # MCP WebSocket API

    environment:
      # ---- SIE configuration ----
      FUSEKI_URL: http://fuseki:3030/ds
      SIE_EMBEDDING_MODE: "oss"
      SIE_OSS_EMBEDDING_URL: http://sie-embedding:8081/embed

      # ---- MCP WebSocket port ----
      SIE_MCP_PORT: 9051

    restart: unless-stopped
    networks:
      - sie-net


networks:
  sie-net:
