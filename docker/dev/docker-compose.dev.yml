version: "3.9"

services:
  # ---------------------------------------------------------
  # Apache Jena Fuseki — RDF triple store (SPARQL endpoint)
  # ---------------------------------------------------------
  fuseki:
    image: stain/jena-fuseki:4.7.0
    container_name: fuseki
    ports:
      - "9030:9030"
    environment:
      - FUSEKI_DATASET=ds
    volumes:
      - fuseki_data:/fuseki

  # ---------------------------------------------------------
  # ChromaDB — Vector database used for embedding retrieval
  # ---------------------------------------------------------
  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb
    ports:
      - "9040:9040"
    environment:
      - IS_PERSISTENT=1
      - ANONYMIZED_TELEMETRY=0
    volumes:
      - chroma_data:/chroma

  # ---------------------------------------------------------
  # RagServer (development build)
  # - Build directly from the project root.
  # - Uses Dockerfile in the root directory.
  # - Picks up dist/semantic-integration-engine.jar generated by sbt assembly.
  # ---------------------------------------------------------
  sie:
    build:
      context: ../../
      dockerfile: Dockerfile
    container_name: sie
    depends_on:
      - fuseki
      - chromadb
    ports:
      - "9050:9050"
    environment:
      FUSEKI_URL: http://fuseki:9030/ds
      CHROMA_URL: http://chromadb:9040
      SIESERVER_PORT: 9050

volumes:
  fuseki_data:
  chroma_data:
