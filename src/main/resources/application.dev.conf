# ============================================================
# DEV Configuration Specification
# ============================================================
#
# This file describes DEV-mode *intent* only.
#
# Endpoint resolution policy for DEV mode:
#
#   Components:
#     - GraphDB (Fuseki)
#     - VectorDB (Chroma / sie-embedding)
#     - Embedding service
#
#   Default behavior:
#     - Endpoints for the above components are resolved
#       programmatically by AppConfig (DEV defaults).
#     - Typical DEV defaults assume:
#
#         SIE          : running OUTSIDE Docker (sbt dev)
#         GraphDB      : running INSIDE Docker
#         VectorDB     : running INSIDE Docker
#
#       with connections via localhost and published ports.
#
#   Override rules (highest priority first):
#
#     1. Environment variables
#          - FUSEKI_URL
#          - SIE_VECTORDB_ENDPOINT
#          - SIE_EMBEDDING_ENDPOINT
#
#     2. application.dev.conf
#          - Explicit endpoint definitions here
#            override AppConfig DEV defaults.
#          - Intended for ADVANCED or exceptional DEV setups
#            (e.g. SIE itself running inside Docker,
#             remote Fuseki, cloud VectorDB, etc.).
#
#     3. AppConfig DEV defaults
#          - Last-resort safety net ensuring zero-config startup.
#
# Design intent:
#
#   - Do NOT duplicate standard DEV endpoints here.
#   - Use this file to document intent and exceptional overrides.
#   - Keep infrastructure constants centralized in AppConfig.
#
# ============================================================

server {
  # Development mode: bind only to localhost
  host = "0.0.0.0"
  sie-port = 9050
  mode = "dev"
}

# --- MCP WebSocket (DEV) ---
#
# Explicitly enable MCP WebSocket server for DEV runtime
# so that MCP protocol conversations can be captured
# using tools like websocat.
#
server.mcp {
  enabled = true

  websocket {
    host = "0.0.0.0"
    port = 9051
  }
}

# --- Fuseki (RDF Store) ---
fuseki {
  # Host JVM (sbt dev) must access Fuseki via published port
  endpoint = "http://localhost:9030/ds"
}

# --- ChromaDB (Vector Store) ---
chroma {
  # Host JVM (sbt dev) must access sie-embedding via published port
  endpoint = "http://localhost:8081"
  collection = "simplemodeling"
}

# --- Embedding Server (onnxruntime) ---
# In DEV mode, embedding must be explicitly enabled here because
# sbt dev cannot inject docker-compose environment variables.
# This aligns DEV semantics with DEMO/PROD while keeping configuration centralized.
embedding {
  mode = "oss"
  # sie-embedding exposes /embed (not /embedding)
  endpoint = "http://localhost:8081/embed"
}

# --- Logging ---
logging {
  level = "DEBUG"
}

mcp {
  merge-manifest-into-initialize = false
  merge-manifest-into-initialize = ${?SIE_MCP_MERGE_MANIFEST}
}
